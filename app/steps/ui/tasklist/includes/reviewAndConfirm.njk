{% set previousTaskStatus = fields.previousTaskStatus.value.ReviewAndConfirmTask %}

<li class="task-item">
    {{ taskHeader(
        number = "3.",
        content = content,
        title = content.reviewAndConfirmTask,
        status = "pending" if (
                fields.ReviewAndConfirmTask.value.status == "complete" and
                fields.hasMultipleApplicants.value == "true" and
                fields.alreadyDeclared.value == "false"
            ) else fields.ReviewAndConfirmTask.value.status,
        previousTaskStatus = fields.previousTaskStatus.value.ReviewAndConfirmTask
    ) }}
    <div class="task-list-items">
        {{ taskAction(
            prevTaskStatus = previousTaskStatus,
            status = fields.ReviewAndConfirmTask.value.status,
            nextURL = "summary/declaration",
            checkYourAnswersURL = fields.ReviewAndConfirmTask.value.checkYourAnswersLink,
            content = content,
            title = content.reviewAndConfirmTask,
            alreadyDeclared = fields.alreadyDeclared.value
        ) }}
        {% if fields.ReviewAndConfirmTask.value.status == "complete" %}
            {% if fields.hasMultipleApplicants.value == "true" and fields.alreadyDeclared.value == "false" %}
                <p class="govuk-body">{{ content.reviewAndConfirmTaskMultiplesParagraph1 }}</p>
                <p class="govuk-body">{{ content.reviewAndConfirmTaskMultiplesParagraph2 }}</p>

                {% if fields.declarationStatuses.value | length > 0 %}
                    {% set declarationStatusRows = [] %}
                    {% for executor in fields.declarationStatuses.value %}
                        {% set declarationStatusRows = (declarationStatusRows.push([
                            { text: executor.executorName | safe },
                            { text: content.agreed if executor.agreed == "agreed" else (content.disagreed if executor.agreed == "disagreed" else content.notDeclared) }
                        ]), declarationStatusRows) %}
                    {% endfor %}
                    <h3 class="govuk-heading-s">{{ content.reviewAndConfirmTaskMultiplesParagraph3Heading }}</h3>
                    <p class="govuk-body">{{ content.reviewAndConfirmTaskMultiplesParagraph3 }}</p>

                    {{ govukTable({
                      caption: content.reviewAndConfirmTaskMultiplesParagraph3Heading,
                      captionClasses: "govuk-visually-hidden",
                      firstCellIsHeader: false,
                      head: [
                        {
                          text: content.executorName
                        },
                        {
                          text: content.declarationStatus
                        }
                      ],
                      rows: declarationStatusRows
                    }) }}
                {% endif %}
            {% endif %}
        {% endif %}
    </div>
</li>
