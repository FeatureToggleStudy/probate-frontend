{% extends "includes/two_thirds_form.html" %}

{% from "widgets/textfields.html" import textField %}

{% from "fieldset/macro.njk" import govukFieldset %}
{% from "input/macro.njk" import govukInput %}
{% from "button/macro.njk" import govukButton %}


{% block form_content %}
{#    {% if errors %}#}
{#        <div class="error-summary" role="group" aria-labelledby="error-summary-heading" tabindex="-1">#}
{#            <h2 class="govuk-heading-m error-summary-heading" id="error-summary-heading">#}
{#                {{ common.errorSummaryHeading | safe }}#}
{#            </h2>#}
{#            <ul class="error-summary-list">#}
{#                {% for index, otherNameErrors in errors %}#}
{#                    {% for error in otherNameErrors %}#}
{#                        <li><a href="#otherNames_{{ index }}_{{ error.param }}">{{ error.msg.summary | safe }}</a></li>#}
{#                    {% endfor %}#}
{#                {% endfor %}#}
{#            </ul>#}
{#        </div>#}
{#    {% endif %}#}

    {% set hasOtherNames = false %}
    {% for index, otherName in fields.otherNames.value %}
        {% call govukFieldset({
            legend: {
                text: (content.question | replace("{deceasedName}", fields.deceasedFullName.value) if index == "name_0" else content.otherName) | safe,
                classes: ("govuk-fieldset__legend--l" if index == "name_0" else "govuk-fieldset__legend--m"),
                isPageHeading: (true if index == "name_0" else false)
            }
        }) %}
            {% if index !== "name_0" %}
                {% set hasOtherNames = true %}
                {{ govukButton({
                    text: content.removeName,
                    preventDoubleClick: true,
                    classes: "govuk-button--secondary",
                    attributes: {
                        formaction: "/other-names/remove/" + index
                    }
                }) }}
            {% endif %}

            {{ govukInput({
                label: {
                    text: content.firstName
                },
                id: "otherNames_" + index + "_firstName",
                name: "otherNames[" + index + "][firstName]",
                value: otherName["firstName"].value | safe,
                errorMessage: otherName["firstName"].errorMessage,
                attributes: {
                    maxlength: 100
                },
                classes: "govuk-!-width-three-quarters"
            }) }}
            {{ govukInput({
                label: {
                    text: content.lastName
                },
                id: "otherNames_" + index + "_lastName",
                name: "otherNames[" + index + "][lastName]",
                value: otherName["lastName"].value | safe,
                errorMessage: otherName["lastName"].errorMessage,
                attributes: {
                    maxlength: 100
                },
                classes: "govuk-!-width-three-quarters"
            }) }}
        {% endcall %}
    {% endfor %}

    <div class="govuk-form-group">
        {{ govukButton({
            text: content.addAnotherName,
            preventDoubleClick: true,
            classes: "govuk-button--secondary",
            attributes: {
                formaction: "/other-names/add",
                autofocus: "autofocus" if hasOtherNames
            }
        }) }}
    </div>

    <div class="govuk-form-group">
        {{ govukButton({
            text: common.saveAndContinue,
            preventDoubleClick: true
        }) }}
    </div>
{% endblock %}
